#!/usr/bin/python
'''
# Example code for creating accounts for all users with primary group ark
for u in `getent passwd | awk -F: '$4=="230" { print $1 }'`; do
    python ../bin/create-ufs-user ark $u;
done
'''

import sys
import os
from pwd import getpwnam

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__))+'/../')

from django.core.management import setup_environ

from itkufs import settings

setup_environ(settings)

from itkufs.accounting.models import *
from django.contrib.auth.models import User

name  = getpwnam(sys.argv[2])[4].split(',')[0]

if not raw_input('Add %s (%s)? Y/n ' % (sys.argv[2], name)).lower() == 'y':
    print "Skipping %s" % sys.argv[2]
else:
    group = Group.objects.get(slug=sys.argv[1])

    owner, created = User.objects.get_or_create(
            username=sys.argv[2], email='%s@samfundet.no' % sys.argv[2])

    account, created = Account.objects.get_or_create(
            group=group, owner=owner, defaults={
                'name': name,
                'short_name': sys.argv[2],
                'type': Account.LIABILITY_ACCOUNT,
                'slug': sys.argv[2],
            })

    if created:
        print "Created new account for user %s" % owner
    else:
        print "%s all ready has account!" % owner
