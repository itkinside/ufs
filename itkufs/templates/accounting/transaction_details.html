{% extends "accounting/transaction_list.html" %}
{% load i18n %}


{% block breadcrumbs %}
    {{ block.super }}
    &raquo; {% trans "Transaction" %} {{ transaction.id }}</a>
{% endblock %}


{% block content %}

<table class="tabledetails">
    <tr>
        <th>Transaction ID</th>
        <td>{{ transaction.id }}</th>
    </tr>
    <tr>
        <th>Settlement</th>
        <td>
            {% if transaction.settlement %}
                <a href="{% url settlement-details group.slug %}">
                    {{ transaction.settlement }}</a>
            {% else %}
                {% trans "None" %}
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>State</th>
        <td>{{ transaction.get_state_display }}</th>
    </tr>
    <tr>
        <th>Last modified</th>
        <td>{{ transaction.last_modified|date:"Y-m-d H:i" }}</th>
    </tr>
</table>

{% if is_admin and transaction.is_editable %}
FIXME (placement): <a href="{% url edit-transaction group.slug,transaction.id %}">Edit</a>
{% endif %}

<h3>{% trans "Entries" %}</h3>

<table class="tablelist">
    <tr>
        <th>{% trans "Account" %}</th>
        <th>{% trans "Debit" %}</th>
        <th>{% trans "Credit" %}</th>
    </tr>

    {% for e in transaction.entry_set.all %}
    <tr class="{% cycle 'evenrow' 'oddrow' %}
        {% if transaction.is_rejected %}rejected{% else %}
        {% if transaction.is_pending %}pending{% endif %}{% endif %}">
        <td class="account">
            {% if is_admin %}
                {% ifnotequal e.account.group group %}
                <a href="{% url group-summary e.account.group.slug %}">{{ e.account.group.name }}</a>:
                {% endifnotequal %}
                <a href="{% url account-summary e.account.group.slug,e.account.slug%}">{{ e.account.name }}</a>
            {% else %}
                {% ifnotequal e.account.group group %}
                {{ e.account.group.name }}:
                {% endifnotequal %}
                {{ e.account.name }}
            {% endif %}
        </td>
        <td class="align_right debit">
            {% if e.debit %}
            {{ e.debit|floatformat:2 }}
            {% endif %}
        </td>
        <td class="align_right credit">
            {% if e.credit %}
            {{ e.credit|floatformat:2 }}
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

<h3>{% trans "Log" %}</h3>

<table class="tablelist">
    <tr>
        <th>{% trans "State" %}</th>
        <th>{% trans "When" %}</th>
        <th>{% trans "Who" %}</th>
        <th>{% trans "Message" %}</th>
    </tr>

    {% for l in transaction.log_set.all %}
    <tr class="{% cycle 'evenrow' 'oddrow' %}">
        <td>{{ l.get_type_display }}</td>
        <td>{{ l.timestamp|date:"Y-m-d H:i" }}</td>
        <td><a href="mailto:{{ l.user.email }}">{{ l.user }}</a>{% if l.auto %} ({% trans "auto" %}){% endif %}</td>
        <td>{{ l.message }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
